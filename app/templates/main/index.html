{% extends 'layouts/base.html' %}

{% block content %}
    <div class="ui text container">
      <h1>Hello {% if not (current_user.is_authenticated) %} world {% else %} {{ current_user.full_name() }}. Your role is {{ current_user.role.name }}. {% endif %}</h1>
      {% if current_user.is_authenticated and current_user.is_role("applicant") and content is not none %}
        <div id="fb-render"></div>
        <form id="submitForm">
          <input type='submit' class='btn btn-success' value='Submit Form'/>
        </form>
        <script src="http://formbuilder.online/assets/js/form-render.min.js"></script>
        <script>
          jQuery(function($) {
            var fbRender = document.getElementById('fb-render');
            var formData = {{ content | safe }}
            var formRenderOpts = {
              formData
            };
            $(fbRender).formRender(formRenderOpts);
            $("#submitForm").submit(function() {
              var o = {};
              var a = $("#fb-render :input").serializeArray();
              $.each(a, function() {
                if (o[this.name] !== undefined) {
                  if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                  }
                  o[this.name].push(this.value || '');
                }
                else {
                  o[this.name] = this.value || '';
                }
              });
              var settings = {
                  "async": true,
                  "crossDomain": true,
                  "url": "/submit-form",
                  "method": "POST",
                  "headers": {
                    "content-type": "application/json",
                    "cache-control": "no-cache",
                  },
                  "processData": false,
                  "data": JSON.stringify(o)
              };
              $.ajax(settings).done(function (response) {
                console.log(response);
              });
            });
          });
        </script>
      {% endif %}
    </div>
{% endblock %}
